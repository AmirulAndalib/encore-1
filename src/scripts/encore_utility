#!/system/bin/sh

[ -z $DEV_ENV ] && set +x

warn_drm_failed() {
	/system/bin/am start -a android.intent.action.VIEW -d "https://encore.rem01gaming.dev/" >/dev/null
	su -lp 2000 -c "/system/bin/cmd notification post -t 'Encore Tweaks' 'encore' 'DRM Check failed, please re-install Encore Tweaks from official website encore.rem01gaming.dev.'" >/dev/null
}

save_logs() {
	cat <<EOF >/sdcard/encore_log
*****************************************************
Encore Tweaks Log

Module Version: $(grep "version=" /data/adb/modules/encore/module.prop | awk -F'=' '{print $2}')
Chipset: $(getprop "ro.board.platform") ($(cat /data/encore/soc_recognition))
ABI: $(getprop ro.product.cpu.abi)
Fingerprint: $(getprop ro.build.fingerprint)
Android: $(getprop ro.build.version.release)
Kernel: $(uname -r)
*****************************************************

$(cat /data/encore/encore_log)
EOF
}

[ -d /data/adb/modules/encore ] || warn_drm_failed
$@
